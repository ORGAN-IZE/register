{% extends 'base.html' %}
{% load i18n %}
{% load staticfiles %}
{% load bootstrap3 %}
{% load registration_extras %}

{% block head %}
{{ wizard.form.media }}
{% endblock %}

{% block script %}
<script src="{% static 'js/jquery.maskedinput.min.js' %}"></script>
<script src="{% static 'js/main.js' %}"></script>
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-6 col-lg-offset-3 col-md-6 col-md-offset-3 col-sm-8 col-sm-offset-2 col-xs-12">
        <h1>{{ title }}</h1>
    </div>
</div>

<div class="row status-bar">
    <div class="col-lg-6 col-lg-offset-3 col-md-6 col-md-offset-3 col-sm-8 col-sm-offset-2 col-xs-12">
    {% spaceless %}
        {% for step in wizard.steps.all %}
            <div class="step step-{{ step }}
                {% if step <= wizard.steps.current %}
                    organize-red-background
                {% else %}
                    organize-gray-background
                {% endif %}
            ">&nbsp;</div>
        {% endfor %}
        <div class="step-counter">{{ wizard.steps.step1|add:1 }} / {{ wizard.steps.count|add:1 }}</div>
    {% endspaceless %}
    </div>
</div>

{% if cleaned_data %}
<div class="row">
    <div class="col-lg-6 col-lg-offset-3 col-md-6 col-md-offset-3 col-sm-8 col-sm-offset-2 col-xs-12">
        {% for page in configuration %}
            {% if page.fieldsets.0.fields and page.step != 7 %}
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <a class="pull-right" href="{% url 'register' step=page.step %}">edit</a>
                        <h3 class="panel-title">{{ page.title }}</h3>
                    </div>
                    <table class="table">
                        {% for fieldset in page.fieldsets %}
                            {% for field in fieldset.fields %}
                                <tr>
                                    {% if field.type == 'boolean' %}
                                        <td colspan="2" class="">
                                            {% if cleaned_data|key:field.field_name %}
                                                <span class="organize-green">{% bootstrap_icon 'ok-circle' %}</span>
                                            {% else %}
                                                <span class="organize-red">{% bootstrap_icon 'ban-circle' %}</span>
                                            {% endif %}
                                            {{ field.human_name }}
                                        </td>
                                    {% else %}
                                        <td width="200" class="organize-gray">{{ field.human_name }}</td>
                                        {% if field.field_name == 'phone_number' %}
                                            <td width="*">{{ cleaned_data|key:field.field_name|phonenumber }}</td>
                                        {% else %}
                                            <td width="*">{{ cleaned_data|key:field.field_name }}</td>
                                        {% endif %}
                                    {% endif %}
                                </tr>
                            {% endfor %}
                        {% endfor %}
                    </table>
                </div>
            {% endif %}
        {% endfor %}
    </div>
</div>
{% endif %}

{% if terms_of_service %}
<div class="row">
    <div class="col-lg-6 col-lg-offset-3 col-md-6 col-md-offset-3 col-sm-8 col-sm-offset-2 col-sm-offset-2 col-xs-12">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">Terms of Service</h3>
            </div>
            <div class="panel-body" style="max-height: 315px; overflow-y: auto;">
                {{ terms_of_service }}
            </div>
        </div>
    </div>
</div>
{% endif %}

<div class="row">
    <div class="col-lg-6 col-lg-offset-3 col-md-6 col-md-offset-3 col-sm-8 col-sm-offset-2 col-xs-12">
    <form role="form" action="." method="post">
        {% csrf_token %}

        {{ wizard.management_form }}
        {% if wizard.form.forms %}
            {{ wizard.form.management_form }}
            {% for form in wizard.form.forms %}
                {% bootstrap_form form %}
            {% endfor %}
        {% else %}
            {% if wizard.form.non_field_errors %}
                {% bootstrap_form_errors wizard.form.non_field_errors %}
            {% endif %}

            {% for fieldset in wizard.form.fieldsets %}
                {% if not forloop.first %}<hr />{% endif %}

                <fieldset class="{{ fieldset.classes }}">

                    {% if wizard.form.fieldsets|length > 1 %}
                        {% if fieldset.legend %}
                            <legend>{{ fieldset.legend }}</legend>
                        {% endif %}
                        {% if fieldset.description %}
                            <p class="description">{{ fieldset.description }}</p>
                        {% endif %}
                    {% endif %}

                    {% for field in fieldset %}

                        {% if field.is_hidden %}
                            {{ field }}
                        {% else %}
                            {% bootstrap_field field=field|tabindex:forloop.parentloop.counter size='lg' %}
                        {% endif %}
                    {% endfor %}
                </fieldset>
            {% endfor %}
        {% endif %}

        <hr />

        {% buttons %}
            <a
                {% if wizard.steps.prev %}
                 href="{% url 'register' step=wizard.steps.prev %}"
                {% else %}
                 href="{% url 'start' %}"
                {% endif %}
             class="btn btn-secondary btn-organize" tabindex="100">&lsaquo; Back</a>

            <button type="submit" class="btn btn-primary btn-organize" tabindex="99">
                {% if wizard.steps.current == wizard.steps.last %}
                    Register &rsaquo;
                {% else %}
                    Next &rsaquo;
                {% endif %}
            </button>
        {% endbuttons %}
    </form>
    </div>
</div>
{% endblock %}
